/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => ProjectTasks
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");

// helpers.ts
var BLOCK_BOUNDARY = /^#+\s/;
var Helper = class {
  // Simple helper class that contains the business logic
  // of the app. This is extracted here to allow unit testing
  constructor() {
  }
  static getNestingLevel(task_marker) {
    let parts = task_marker.replaceAll("\n", "").split("-");
    return parts[0].length;
  }
  static generateRandomDigits(length) {
    const digits = "0123456789";
    let randomString = "";
    for (let i = 0; i < length; i++) {
      const randomIndex = Math.floor(Math.random() * digits.length);
      randomString += digits[randomIndex];
    }
    return randomString;
  }
  static getPrefixFromString(text, first_letters, remove_vowels) {
    text = text.replaceAll(/[#\[\]]/g, "");
    let words = text.split(/\s+/);
    text = "";
    for (let word of words) {
      if (word) {
        text = `${text}${word[0].toUpperCase()}`;
        if (!first_letters) {
          let remainder = word.slice(1);
          if (remove_vowels) {
            remainder = remainder.replaceAll(/[aeiou]/g, "");
          }
          text = `${text}${remainder}`;
        }
      }
    }
    text = text.replaceAll(" ", "");
    return text;
  }
  static clearBlockIDs(sel, automatic_tag) {
    let remove_id = /[ \t]?ðŸ†”\s[\w,]+[ \t]*/g;
    sel = sel.replaceAll(remove_id, "");
    let remove_block = /[ \t]?â›”\s[\w,]+[ \t]*/g;
    sel = sel.replaceAll(remove_block, "");
    if (automatic_tag) {
      let remove_tag = new RegExp("^(\\s*-\\s\\[[ x\\-\\/]]\\s.*)(#" + automatic_tag + ")(.*)$", "mg");
      sel = sel.replaceAll(remove_tag, "$1 $3");
    }
    return sel;
  }
  static getBlockEnd(editor) {
    let blockEnd = editor.getCursor().line;
    if (blockEnd >= editor.lineCount() - 1)
      return blockEnd + 1;
    blockEnd += 1;
    while (!BLOCK_BOUNDARY.test(editor.getLine(blockEnd))) {
      blockEnd++;
      if (blockEnd > editor.lineCount() - 1)
        return blockEnd;
    }
    return blockEnd;
  }
  static getBlockStart(editor) {
    let blockStart = editor.getCursor().line;
    if (BLOCK_BOUNDARY.test(editor.getLine(blockStart))) {
      return Math.min(editor.lineCount() - 1, blockStart + 1);
    }
    while (blockStart > 0 && !BLOCK_BOUNDARY.test(editor.getLine(blockStart - 1))) {
      blockStart--;
    }
    return blockStart;
  }
  static getSectionName(editor, file_name) {
    let section_start = Helper.getBlockStart(editor);
    let section_line;
    if (section_start == 0) {
      section_line = "";
    } else {
      section_line = editor.getLine(section_start - 1);
    }
    let raw_prefix;
    if (BLOCK_BOUNDARY.test(section_line)) {
      raw_prefix = section_line;
    } else {
      raw_prefix = file_name;
    }
    return raw_prefix;
  }
};

// main.ts
var DEBUG = true;
var DEFAULT_SETTINGS = {
  idPrefixMethod: "1" /* UsePrefix */,
  projectPrefix: "prj",
  randomIDLength: 6,
  sequentialStartNumber: 1,
  removeVowels: false,
  firstLettersOfWords: false,
  automaticTagName: "Project",
  nestedTaskBehavior: "1" /* ParallelExecution */
};
var ProjectTasks = class extends import_obsidian.Plugin {
  async onload() {
    if (DEBUG)
      console.log("Project Tasks starting");
    await this.loadSettings();
    this.addCommand({
      id: "set-ids",
      name: "Set project ids on Selection",
      editorCallback: (editor, view) => {
        let sel = editor.getSelection();
        let lines = this.addTaskIDs(sel, this.getPrefix(editor, view));
        editor.replaceSelection(
          `${lines}`
        );
      }
    });
    this.addCommand({
      id: "clear-ids",
      name: "Clear project ids on Selection",
      editorCallback: (editor, view) => {
        let sel = editor.getSelection();
        let lines = Helper.clearBlockIDs(sel, this.settings.automaticTagName);
        editor.replaceSelection(
          `${lines}`
        );
      }
    });
    this.addCommand({
      id: "set-ids-block",
      name: "Set project ids on Block",
      editorCallback: (editor, view) => {
        this.blockUpdate(editor, this.getPrefix(editor, view), true);
      }
    });
    this.addCommand({
      id: "clear-ids-block",
      name: "Clear project ids on Block",
      editorCallback: (editor, view) => {
        this.blockUpdate(editor, this.getPrefix(editor, view), false);
      }
    });
    this.addCommand({
      id: "add-project-task-list",
      name: "Add active project task list",
      editorCallback: (editor, view) => {
        this.addActiveProjectList(editor);
      }
    });
    this.addSettingTab(new ProjectTasksSettingsTab(this.app, this));
  }
  addActiveProjectList(editor) {
    const active_tasks_view = `\`\`\`tasks
tags includes #${this.settings.automaticTagName}
not done
hide backlink
is not blocked
\`\`\``;
    editor.replaceSelection(active_tasks_view);
  }
  blockUpdate(editor, prefix, add_ids) {
    const cursor = editor.getCursor();
    const line = editor.getLine(cursor.line);
    let blockStart = Helper.getBlockStart(editor);
    let blockEnd = Helper.getBlockEnd(editor);
    let last_line_length = editor.getLine(blockEnd + 1).length;
    const blockContent = editor.getRange({ line: blockStart, ch: 0 }, { line: blockEnd, ch: last_line_length });
    if (DEBUG)
      console.log(`Start ${blockStart}, End ${blockEnd}, last length ${last_line_length}
Orig: ${blockContent}`);
    let lines;
    if (add_ids) {
      lines = this.addTaskIDs(blockContent, prefix);
    } else {
      lines = Helper.clearBlockIDs(blockContent, this.settings.automaticTagName);
    }
    if (DEBUG)
      console.log(`Start ${blockStart}, End ${blockEnd}, last length ${last_line_length}
Orig: ${blockContent}
New: ${lines}`);
    editor.replaceRange(lines, { line: blockStart, ch: 0 }, { line: blockEnd, ch: last_line_length });
  }
  getPrefix(editor, view) {
    let raw_prefix;
    switch (this.settings.idPrefixMethod) {
      case "1" /* UsePrefix */: {
        raw_prefix = this.settings.projectPrefix;
        break;
      }
      case "3" /* FileName */: {
        raw_prefix = this.getFilename(view);
        break;
      }
      case "2" /* SectionName */: {
        raw_prefix = Helper.getSectionName(editor, this.getFilename(view));
      }
    }
    return Helper.getPrefixFromString(raw_prefix, this.settings.firstLettersOfWords, this.settings.removeVowels);
  }
  getFilename(view) {
    var _a;
    if (!((_a = view.file) == null ? void 0 : _a.name)) {
      return this.settings.projectPrefix;
    } else {
      return view.file.name.split(".")[0];
    }
  }
  addTaskIDs(sel, prefix) {
    const regex = /^(\s*-\s\[[ x\-\/]\]\s)?(.*)$/mg;
    sel = Helper.clearBlockIDs(sel, this.settings.automaticTagName);
    if (DEBUG)
      console.log(`Replaced ids and blocks to give: ${sel}`);
    const matches = sel.matchAll(regex);
    let lines = "";
    let first = true;
    let idx = 0;
    let nesting_ids = ["0:ERROR!"];
    let current_nesting = 0;
    let is_parallel = false;
    let this_id;
    for (const match of matches) {
      if (!first) {
        lines += "\n";
      }
      if (match[1]) {
        if (this.settings.nestedTaskBehavior == "1" /* ParallelExecution */) {
          let nesting_depth = Helper.getNestingLevel(match[1]);
          if (nesting_depth > current_nesting) {
            current_nesting += 1;
            is_parallel = true;
            nesting_ids.push(``);
          } else if (nesting_depth < current_nesting) {
            while (current_nesting > nesting_depth) {
              current_nesting -= 1;
              let nested = nesting_ids.pop();
              if (nested) {
                nesting_ids[nesting_ids.length - 1] += `,${nested}`;
              }
              is_parallel = current_nesting > 0;
            }
          }
        }
        let this_line;
        if (this.settings.idPrefixMethod == "1" /* UsePrefix */) {
          this_id = `${prefix}${Helper.generateRandomDigits(this.settings.randomIDLength)}`;
        } else {
          this_id = `${prefix}${idx + this.settings.sequentialStartNumber}`;
        }
        this_line = `${match[1]}${match[2].trim()} \u{1F194} ${this_id}`;
        if (idx > 0) {
          if (is_parallel) {
            this_line += ` \u26D4 ${nesting_ids[current_nesting - 1]}`;
          } else {
            this_line += ` \u26D4 ${nesting_ids.last()}`;
          }
        }
        if (this.settings.automaticTagName) {
          this_line += ` #${this.settings.automaticTagName}`;
        }
        lines += this_line;
        idx += 1;
        if (is_parallel) {
          if (nesting_ids.last())
            nesting_ids[nesting_ids.length - 1] += ",";
          nesting_ids[nesting_ids.length - 1] += `${this_id}`;
        } else {
          nesting_ids[nesting_ids.length - 1] = this_id;
        }
        if (DEBUG)
          console.log(`Nesting level ${current_nesting}, ids ${nesting_ids}`);
      } else {
        lines += `${match[2].trim()}`;
      }
      first = false;
    }
    return lines;
  }
  onunload() {
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
var ProjectTasksSettingsTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian.Setting(containerEl).setName("Project ID method").setDesc("Choose how the ID will be determined").addDropdown((dropDown) => {
      dropDown.addOption("1", "Use prefix");
      dropDown.addOption("2", "Use Section name");
      dropDown.addOption("3", "Use filename").setValue(this.plugin.settings.idPrefixMethod).onChange(async (value) => {
        this.plugin.settings.idPrefixMethod = value;
        await this.plugin.saveSettings();
      });
    });
    new import_obsidian.Setting(containerEl).setName("Project ID prefix").setDesc("Prefix to use when creating an ID for a task").addText((text) => text.setPlaceholder("ID prefix").setValue(this.plugin.settings.projectPrefix).onChange(async (value) => {
      this.plugin.settings.projectPrefix = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Length of random ID number").setDesc("How many digits to use for random ID when using a fixed prefix").addSlider((text) => text.setValue(this.plugin.settings.randomIDLength).setLimits(3, 6, 1).setDynamicTooltip().onChange(async (value) => {
      this.plugin.settings.randomIDLength = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Initial sequential ID number").setDesc("Start number for sequential ID's").addSlider((text) => text.setValue(this.plugin.settings.sequentialStartNumber).setLimits(0, 1, 1).setDynamicTooltip().onChange(async (value) => {
      this.plugin.settings.sequentialStartNumber = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Remove vowels").setDesc("Remove vowels from the prefix when getting from the filename or block name").addToggle((text) => text.setValue(this.plugin.settings.removeVowels).onChange(async (value) => {
      this.plugin.settings.removeVowels = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("First letter of words").setDesc("Only use the first letter of words to form the prefix").addToggle((text) => text.setValue(this.plugin.settings.firstLettersOfWords).onChange(async (value) => {
      this.plugin.settings.firstLettersOfWords = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Automatically add Tag").setDesc("A tag to add to each task - do not include the # symbol").addText((text) => text.setValue(this.plugin.settings.automaticTagName).setPlaceholder("Tag Name").onChange(async (value) => {
      this.plugin.settings.automaticTagName = value.replaceAll("#", "");
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Nested tags behaviour").setDesc("Determines whether nested tags will create parallel execution tags or sequential").addDropdown((dropDown) => {
      dropDown.addOption("1", "Parallel Execution");
      dropDown.addOption("2", "Sequential Execution").setValue(this.plugin.settings.nestedTaskBehavior).onChange(async (value) => {
        this.plugin.settings.nestedTaskBehavior = value;
        await this.plugin.saveSettings();
      });
    });
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJoZWxwZXJzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQge1xuICAgIEFwcCxcbiAgICBFZGl0b3IsXG4gICAgRWRpdG9yUG9zaXRpb24sIE1hcmtkb3duRmlsZUluZm8sXG4gICAgTWFya2Rvd25WaWV3LFxuICAgIE1vZGFsLFxuICAgIE5vdGljZSxcbiAgICBQbHVnaW4sXG4gICAgUGx1Z2luU2V0dGluZ1RhYixcbiAgICBTZXR0aW5nLFxuICAgIFZpZXdcbn0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0ICogYXMgbmV0IGZyb20gXCJuZXRcIjtcbmltcG9ydCBIZWxwZXIgZnJvbSBcIi4vaGVscGVyc1wiO1xuXG4vLyBUdXJuIG9uIHRvIGFsbG93IGRlYnVnZ2luZyBpbiB0aGUgY29uc29sZVxuY29uc3QgREVCVUcgPSB0cnVlO1xuXG4vLyBSZWdleCBmb3IgYmxvY2sgYm91bmRhcnlcbi8vIFRvRG8gLSB0aGlzIGlzIGR1cGxpY2F0ZWQgaW4gdGhlIEhlbHBlciBjbGFzcywgc2hvdWxkIHJlZmFjdG9yIHRoaXNcbmNvbnN0IEJMT0NLX0JPVU5EQVJZID0gL14jK1xccy87XG5cblxuZW51bSBQcmVmaXhNZXRob2Qge1xuICAgIFVzZVByZWZpeD0gJzEnLFxuICAgIFNlY3Rpb25OYW1lID0gJzInLFxuICAgIEZpbGVOYW1lID0gJzMnXG59XG5cbmVudW0gTmVzdGluZ0JlaGF2aW91ciB7XG4gICAgUGFyYWxsZWxFeGVjdXRpb24gPSAnMScsXG4gICAgU2VxdWVudGlhbEV4ZWN1dGlvbiA9ICcyJyxcbn1cblxuaW50ZXJmYWNlIFByb2plY3RUYXNrc1NldHRpbmdzIHtcbiAgICBpZFByZWZpeE1ldGhvZDogUHJlZml4TWV0aG9kO1xuICAgIHByb2plY3RQcmVmaXg6IHN0cmluZztcbiAgICByYW5kb21JRExlbmd0aDogbnVtYmVyO1xuICAgIHNlcXVlbnRpYWxTdGFydE51bWJlcjogbnVtYmVyO1xuICAgIHJlbW92ZVZvd2VsczogYm9vbGVhbjtcbiAgICBmaXJzdExldHRlcnNPZldvcmRzOiBib29sZWFuO1xuICAgIGF1dG9tYXRpY1RhZ05hbWU6IHN0cmluZztcbiAgICBuZXN0ZWRUYXNrQmVoYXZpb3I6IE5lc3RpbmdCZWhhdmlvdXI7XG5cbn1cblxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogUHJvamVjdFRhc2tzU2V0dGluZ3MgPSB7XG4gICAgaWRQcmVmaXhNZXRob2Q6IFByZWZpeE1ldGhvZC5Vc2VQcmVmaXgsXG4gICAgcHJvamVjdFByZWZpeDogJ3ByaicsXG4gICAgcmFuZG9tSURMZW5ndGg6IDYsXG4gICAgc2VxdWVudGlhbFN0YXJ0TnVtYmVyOiAxLFxuICAgIHJlbW92ZVZvd2VsczogZmFsc2UsXG4gICAgZmlyc3RMZXR0ZXJzT2ZXb3JkczogZmFsc2UsXG4gICAgYXV0b21hdGljVGFnTmFtZTogXCJQcm9qZWN0XCIsXG4gICAgbmVzdGVkVGFza0JlaGF2aW9yOiBOZXN0aW5nQmVoYXZpb3VyLlBhcmFsbGVsRXhlY3V0aW9uLFxufVxuXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb2plY3RUYXNrcyBleHRlbmRzIFBsdWdpbiB7XG4gICAgc2V0dGluZ3M6IFByb2plY3RUYXNrc1NldHRpbmdzO1xuXG4gICAgYXN5bmMgb25sb2FkKCkge1xuICAgICAgICBpZiAoREVCVUcpIGNvbnNvbGUubG9nKCdQcm9qZWN0IFRhc2tzIHN0YXJ0aW5nJyk7XG5cbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcblxuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgaWQ6IFwic2V0LWlkc1wiLFxuICAgICAgICAgICAgbmFtZTogXCJTZXQgcHJvamVjdCBpZHMgb24gU2VsZWN0aW9uXCIsXG4gICAgICAgICAgICBlZGl0b3JDYWxsYmFjazogKGVkaXRvciwgdmlldykgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBzZWwgPSBlZGl0b3IuZ2V0U2VsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgbGV0IGxpbmVzID0gdGhpcy5hZGRUYXNrSURzKHNlbCwgdGhpcy5nZXRQcmVmaXgoZWRpdG9yLCB2aWV3KSk7XG4gICAgICAgICAgICAgICAgZWRpdG9yLnJlcGxhY2VTZWxlY3Rpb24oXG4gICAgICAgICAgICAgICAgICAgIGAke2xpbmVzfWBcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgaWQ6IFwiY2xlYXItaWRzXCIsXG4gICAgICAgICAgICBuYW1lOiBcIkNsZWFyIHByb2plY3QgaWRzIG9uIFNlbGVjdGlvblwiLFxuICAgICAgICAgICAgZWRpdG9yQ2FsbGJhY2s6IChlZGl0b3IsIHZpZXcpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgc2VsID0gZWRpdG9yLmdldFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgIGxldCBsaW5lcyA9IEhlbHBlci5jbGVhckJsb2NrSURzKHNlbCwgdGhpcy5zZXR0aW5ncy5hdXRvbWF0aWNUYWdOYW1lKTtcbiAgICAgICAgICAgICAgICBlZGl0b3IucmVwbGFjZVNlbGVjdGlvbihcbiAgICAgICAgICAgICAgICAgICAgYCR7bGluZXN9YFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBpZDogXCJzZXQtaWRzLWJsb2NrXCIsXG4gICAgICAgICAgICBuYW1lOiBcIlNldCBwcm9qZWN0IGlkcyBvbiBCbG9ja1wiLFxuICAgICAgICAgICAgZWRpdG9yQ2FsbGJhY2s6IChlZGl0b3IsIHZpZXcpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmJsb2NrVXBkYXRlKGVkaXRvciwgdGhpcy5nZXRQcmVmaXgoZWRpdG9yLCB2aWV3KSwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG5cbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiBcImNsZWFyLWlkcy1ibG9ja1wiLFxuICAgICAgICAgICAgbmFtZTogXCJDbGVhciBwcm9qZWN0IGlkcyBvbiBCbG9ja1wiLFxuICAgICAgICAgICAgZWRpdG9yQ2FsbGJhY2s6IChlZGl0b3IsIHZpZXcpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmJsb2NrVXBkYXRlKGVkaXRvciwgdGhpcy5nZXRQcmVmaXgoZWRpdG9yLCB2aWV3KSwgZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBpZDogXCJhZGQtcHJvamVjdC10YXNrLWxpc3RcIixcbiAgICAgICAgICAgIG5hbWU6IFwiQWRkIGFjdGl2ZSBwcm9qZWN0IHRhc2sgbGlzdFwiLFxuICAgICAgICAgICAgZWRpdG9yQ2FsbGJhY2s6IChlZGl0b3IsIHZpZXcpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZEFjdGl2ZVByb2plY3RMaXN0KGVkaXRvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gVGhpcyBhZGRzIGEgc2V0dGluZ3MgdGFiIHNvIHRoZSB1c2VyIGNhbiBjb25maWd1cmUgdmFyaW91cyBhc3BlY3RzIG9mIHRoZSBwbHVnaW5cbiAgICAgICAgdGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBQcm9qZWN0VGFza3NTZXR0aW5nc1RhYih0aGlzLmFwcCwgdGhpcykpO1xuXG4gICAgfVxuXG4gICAgYWRkQWN0aXZlUHJvamVjdExpc3QoZWRpdG9yOiBFZGl0b3IpIHtcbiAgICAgICAgLy8gQSB2aWV3IHRvIHNob3cgYWN0aXZlIHRhc2tzXG4gICAgICAgIGNvbnN0IGFjdGl2ZV90YXNrc192aWV3ID0gYFxcYFxcYFxcYHRhc2tzXG50YWdzIGluY2x1ZGVzICMke3RoaXMuc2V0dGluZ3MuYXV0b21hdGljVGFnTmFtZX1cbm5vdCBkb25lXG5oaWRlIGJhY2tsaW5rXG5pcyBub3QgYmxvY2tlZFxuXFxgXFxgXFxgYDtcbiAgICAgICAgZWRpdG9yLnJlcGxhY2VTZWxlY3Rpb24oYWN0aXZlX3Rhc2tzX3ZpZXcpO1xuICAgIH1cblxuICAgIGJsb2NrVXBkYXRlKGVkaXRvcjogRWRpdG9yLCBwcmVmaXg6IHN0cmluZywgYWRkX2lkczogYm9vbGVhbikge1xuICAgICAgICBjb25zdCBjdXJzb3IgPSBlZGl0b3IuZ2V0Q3Vyc29yKCk7XG4gICAgICAgIGNvbnN0IGxpbmUgPSBlZGl0b3IuZ2V0TGluZShjdXJzb3IubGluZSk7XG5cbiAgICAgICAgLy8gR2V0IHRoZSBibG9jayBib3VuZGFyaWVzXG4gICAgICAgIGxldCBibG9ja1N0YXJ0ID0gSGVscGVyLmdldEJsb2NrU3RhcnQoZWRpdG9yKTtcbiAgICAgICAgbGV0IGJsb2NrRW5kID0gSGVscGVyLmdldEJsb2NrRW5kKGVkaXRvcik7XG4gICAgICAgIGxldCBsYXN0X2xpbmVfbGVuZ3RoID0gZWRpdG9yLmdldExpbmUoYmxvY2tFbmQgKyAxKS5sZW5ndGg7XG5cbiAgICAgICAgY29uc3QgYmxvY2tDb250ZW50ID0gZWRpdG9yLmdldFJhbmdlKHsgbGluZTogYmxvY2tTdGFydCwgY2g6IDAgfSwgeyBsaW5lOiBibG9ja0VuZCwgY2g6IGxhc3RfbGluZV9sZW5ndGggfSk7XG4gICAgICAgIGlmIChERUJVRykgY29uc29sZS5sb2coYFN0YXJ0ICR7YmxvY2tTdGFydH0sIEVuZCAke2Jsb2NrRW5kfSwgbGFzdCBsZW5ndGggJHtsYXN0X2xpbmVfbGVuZ3RofVxcbk9yaWc6ICR7YmxvY2tDb250ZW50fWApO1xuXG4gICAgICAgIGxldCBsaW5lcztcbiAgICAgICAgaWYgKGFkZF9pZHMpIHtcbiAgICAgICAgICAgIGxpbmVzID0gdGhpcy5hZGRUYXNrSURzKGJsb2NrQ29udGVudCwgcHJlZml4KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxpbmVzID0gSGVscGVyLmNsZWFyQmxvY2tJRHMoYmxvY2tDb250ZW50LCB0aGlzLnNldHRpbmdzLmF1dG9tYXRpY1RhZ05hbWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKERFQlVHKSBjb25zb2xlLmxvZyhgU3RhcnQgJHtibG9ja1N0YXJ0fSwgRW5kICR7YmxvY2tFbmR9LCBsYXN0IGxlbmd0aCAke2xhc3RfbGluZV9sZW5ndGh9XFxuT3JpZzogJHtibG9ja0NvbnRlbnR9XFxuTmV3OiAke2xpbmVzfWApO1xuICAgICAgICBlZGl0b3IucmVwbGFjZVJhbmdlKGxpbmVzLCB7IGxpbmU6IGJsb2NrU3RhcnQsIGNoOiAwIH0sIHsgbGluZTogYmxvY2tFbmQsIGNoOiBsYXN0X2xpbmVfbGVuZ3RoIH0pO1xuICAgIH1cblxuICAgIGdldFByZWZpeChlZGl0b3I6IEVkaXRvciwgdmlldzogTWFya2Rvd25GaWxlSW5mbykge1xuICAgICAgICBsZXQgcmF3X3ByZWZpeDtcbiAgICAgICAgc3dpdGNoICh0aGlzLnNldHRpbmdzLmlkUHJlZml4TWV0aG9kKSB7XG4gICAgICAgICAgICBjYXNlIFByZWZpeE1ldGhvZC5Vc2VQcmVmaXg6IHtcbiAgICAgICAgICAgICAgICByYXdfcHJlZml4ID0gdGhpcy5zZXR0aW5ncy5wcm9qZWN0UHJlZml4O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBQcmVmaXhNZXRob2QuRmlsZU5hbWU6IHtcbiAgICAgICAgICAgICAgICByYXdfcHJlZml4ID0gdGhpcy5nZXRGaWxlbmFtZSh2aWV3KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgUHJlZml4TWV0aG9kLlNlY3Rpb25OYW1lOiB7XG4gICAgICAgICAgICAgICAgLy8gVHJ5IHRvIGZpbmQgdGhlIG5hbWUgb2YgdGhlIGJsb2NrIHRoYXQgY29udGFpbnMgdGhlIGN1cnNvciBvciB0aGUgc2VsZWN0aW9uXG4gICAgICAgICAgICAgICAgcmF3X3ByZWZpeCA9IEhlbHBlci5nZXRTZWN0aW9uTmFtZShlZGl0b3IsIHRoaXMuZ2V0RmlsZW5hbWUodmlldykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBIZWxwZXIuZ2V0UHJlZml4RnJvbVN0cmluZyhyYXdfcHJlZml4LCB0aGlzLnNldHRpbmdzLmZpcnN0TGV0dGVyc09mV29yZHMsIHRoaXMuc2V0dGluZ3MucmVtb3ZlVm93ZWxzKTtcbiAgICB9XG5cbiAgICBnZXRGaWxlbmFtZSh2aWV3OiBNYXJrZG93bkZpbGVJbmZvKSB7XG4gICAgICAgaWYgKCF2aWV3LmZpbGU/Lm5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNldHRpbmdzLnByb2plY3RQcmVmaXg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdmlldy5maWxlLm5hbWUuc3BsaXQoJy4nKVswXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFkZFRhc2tJRHMoc2VsOiBzdHJpbmcsIHByZWZpeDogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IHJlZ2V4ID0gL14oXFxzKi1cXHNcXFtbIHhcXC1cXC9dXFxdXFxzKT8oLiopJC9tZztcblxuICAgICAgICAvLyBDbGVhciBhbGwgdGhlIGV4aXN0aW5nIGJsb2NrIGFuZCBwcm9qZWN0IElEJ3NcbiAgICAgICAgc2VsID0gSGVscGVyLmNsZWFyQmxvY2tJRHMoc2VsLCB0aGlzLnNldHRpbmdzLmF1dG9tYXRpY1RhZ05hbWUpO1xuXG4gICAgICAgIGlmIChERUJVRykgY29uc29sZS5sb2coYFJlcGxhY2VkIGlkcyBhbmQgYmxvY2tzIHRvIGdpdmU6ICR7c2VsfWApO1xuXG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSBzZWwubWF0Y2hBbGwocmVnZXgpO1xuICAgICAgICBsZXQgbGluZXMgPSBcIlwiO1xuICAgICAgICBsZXQgZmlyc3QgPSB0cnVlO1xuICAgICAgICBsZXQgaWR4ID0gMDtcbiAgICAgICAgbGV0IG5lc3RpbmdfaWRzID0gW1wiMDpFUlJPUiFcIl07XG4gICAgICAgIGxldCBjdXJyZW50X25lc3RpbmcgPSAwO1xuICAgICAgICBsZXQgaXNfcGFyYWxsZWwgPSBmYWxzZTtcbiAgICAgICAgbGV0IHRoaXNfaWQ7XG5cbiAgICAgICAgLy8gR28gdGhyb3VnaCBhbGwgdGhlIGxpbmVzIGFuZCBhZGQgYXBwcm9wcmlhdGUgSUQgYW5kIGJsb2NrIHRhZ3NcbiAgICAgICAgZm9yIChjb25zdCBtYXRjaCBvZiBtYXRjaGVzKSB7XG4gICAgICAgICAgICBpZiAoIWZpcnN0KSB7XG4gICAgICAgICAgICAgICAgbGluZXMgKz0gXCJcXG5cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIElzIHRoaXMgYSB0YXNrIGxpbmUgYXQgYWxsP1xuICAgICAgICAgICAgaWYgKG1hdGNoWzFdKSB7XG4gICAgICAgICAgICAgICAgLy8gV2F0Y2ggb3V0IGZvciBjaGFuZ2VzIGluIG5lc3RpbmdcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5uZXN0ZWRUYXNrQmVoYXZpb3IgPT0gTmVzdGluZ0JlaGF2aW91ci5QYXJhbGxlbEV4ZWN1dGlvbikge1xuICAgICAgICAgICAgICAgICAgICBsZXQgbmVzdGluZ19kZXB0aCA9IEhlbHBlci5nZXROZXN0aW5nTGV2ZWwobWF0Y2hbMV0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAobmVzdGluZ19kZXB0aCA+IGN1cnJlbnRfbmVzdGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGEgbmV3IGxldmVsIG9mIG5lc3RpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfbmVzdGluZyArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgaXNfcGFyYWxsZWwgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgbmVzdGluZ19pZHMucHVzaChgYCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmVzdGluZ19kZXB0aCA8IGN1cnJlbnRfbmVzdGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGxldmVscyBvZiBuZXN0aW5nXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoY3VycmVudF9uZXN0aW5nID4gbmVzdGluZ19kZXB0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfbmVzdGluZyAtPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBuZXN0ZWQgPSBuZXN0aW5nX2lkcy5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobmVzdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5lc3RpbmdfaWRzW25lc3RpbmdfaWRzLmxlbmd0aCAtIDFdICs9IGAsJHtuZXN0ZWR9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNfcGFyYWxsZWwgPSBjdXJyZW50X25lc3RpbmcgPiAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxldCB0aGlzX2xpbmU7XG4gICAgICAgICAgICAgICAgLy8gR2V0IGFuIGlkIHRvIHVzZVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmlkUHJlZml4TWV0aG9kID09IFByZWZpeE1ldGhvZC5Vc2VQcmVmaXgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpc19pZCA9IGAke3ByZWZpeH0ke0hlbHBlci5nZW5lcmF0ZVJhbmRvbURpZ2l0cyh0aGlzLnNldHRpbmdzLnJhbmRvbUlETGVuZ3RoKX1gO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXNfaWQgPSBgJHtwcmVmaXh9JHtpZHggKyB0aGlzLnNldHRpbmdzLnNlcXVlbnRpYWxTdGFydE51bWJlcn1gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBBZGQgdGhlIGlkIGludG8gdGhlcmVcbiAgICAgICAgICAgICAgICB0aGlzX2xpbmUgPSBgJHttYXRjaFsxXX0ke21hdGNoWzJdLnRyaW0oKX0gXHVEODNDXHVERDk0ICR7dGhpc19pZH1gO1xuICAgICAgICAgICAgICAgIGlmIChpZHggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgYmxvY2tzIGFmdGVyIHRoZSB2ZXJ5IGZpcnN0IHRhc2tcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzX3BhcmFsbGVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzX2xpbmUgKz0gYCBcdTI2RDQgJHtuZXN0aW5nX2lkc1tjdXJyZW50X25lc3RpbmcgLSAxXX1gO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpc19saW5lICs9IGAgXHUyNkQ0ICR7bmVzdGluZ19pZHMubGFzdCgpfWA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBBZGQgYW4gYXV0b21hdGljIHRhZyBpZiB3ZSBuZWVkIGl0XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuYXV0b21hdGljVGFnTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzX2xpbmUgKz0gYCAjJHt0aGlzLnNldHRpbmdzLmF1dG9tYXRpY1RhZ05hbWV9YDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBBcHBlbmQgdGhpcyBsaW5lXG4gICAgICAgICAgICAgICAgbGluZXMgKz0gdGhpc19saW5lO1xuICAgICAgICAgICAgICAgIGlkeCArPSAxO1xuICAgICAgICAgICAgICAgIGlmIChpc19wYXJhbGxlbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobmVzdGluZ19pZHMubGFzdCgpKSBuZXN0aW5nX2lkc1tuZXN0aW5nX2lkcy5sZW5ndGggLSAxXSArPSBcIixcIjtcbiAgICAgICAgICAgICAgICAgICAgbmVzdGluZ19pZHNbbmVzdGluZ19pZHMubGVuZ3RoIC0gMV0gKz0gYCR7dGhpc19pZH1gO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG5lc3RpbmdfaWRzW25lc3RpbmdfaWRzLmxlbmd0aCAtIDFdID0gdGhpc19pZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKERFQlVHKSBjb25zb2xlLmxvZyhgTmVzdGluZyBsZXZlbCAke2N1cnJlbnRfbmVzdGluZ30sIGlkcyAke25lc3RpbmdfaWRzfWApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBOb3QgYSB0YXNrIGxpbmUgc28ganVzdCBrZWVwIGl0IGFzIGlzXG4gICAgICAgICAgICAgICAgbGluZXMgKz0gYCR7bWF0Y2hbMl0udHJpbSgpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmaXJzdCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsaW5lcztcbiAgICB9XG5cbiAgICBvbnVubG9hZCgpIHtcblxuICAgIH1cblxuICAgIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfU0VUVElOR1MsIGF3YWl0IHRoaXMubG9hZERhdGEoKSk7XG4gICAgfVxuXG4gICAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuICAgICAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuICAgIH1cbn1cblxuXG5jbGFzcyBQcm9qZWN0VGFza3NTZXR0aW5nc1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xuICAgIHBsdWdpbjogUHJvamVjdFRhc2tzO1xuXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogUHJvamVjdFRhc2tzKSB7XG4gICAgICAgIHN1cGVyKGFwcCwgcGx1Z2luKTtcbiAgICAgICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgfVxuXG4gICAgZGlzcGxheSgpOiB2b2lkIHtcbiAgICAgICAgY29uc3Qge2NvbnRhaW5lckVsfSA9IHRoaXM7XG5cbiAgICAgICAgY29udGFpbmVyRWwuZW1wdHkoKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdQcm9qZWN0IElEIG1ldGhvZCcpXG4gICAgICAgICAgICAuc2V0RGVzYygnQ2hvb3NlIGhvdyB0aGUgSUQgd2lsbCBiZSBkZXRlcm1pbmVkJylcbiAgICAgICAgICAgIC5hZGREcm9wZG93bihkcm9wRG93biA9PiB7XG4gICAgICAgICAgICAgICAgZHJvcERvd24uYWRkT3B0aW9uKCcxJywgJ1VzZSBwcmVmaXgnKTtcbiAgICAgICAgICAgICAgICBkcm9wRG93bi5hZGRPcHRpb24oJzInLCAnVXNlIFNlY3Rpb24gbmFtZScpO1xuICAgICAgICAgICAgICAgIGRyb3BEb3duLmFkZE9wdGlvbignMycsICdVc2UgZmlsZW5hbWUnKVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5pZFByZWZpeE1ldGhvZClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmlkUHJlZml4TWV0aG9kID0gdmFsdWUgYXMgUHJlZml4TWV0aG9kO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KX0pO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ1Byb2plY3QgSUQgcHJlZml4JylcbiAgICAgICAgICAgIC5zZXREZXNjKCdQcmVmaXggdG8gdXNlIHdoZW4gY3JlYXRpbmcgYW4gSUQgZm9yIGEgdGFzaycpXG4gICAgICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ0lEIHByZWZpeCcpXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnByb2plY3RQcmVmaXgpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcm9qZWN0UHJlZml4ID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdMZW5ndGggb2YgcmFuZG9tIElEIG51bWJlcicpXG4gICAgICAgICAgICAuc2V0RGVzYygnSG93IG1hbnkgZGlnaXRzIHRvIHVzZSBmb3IgcmFuZG9tIElEIHdoZW4gdXNpbmcgYSBmaXhlZCBwcmVmaXgnKVxuICAgICAgICAgICAgLmFkZFNsaWRlcih0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MucmFuZG9tSURMZW5ndGgpXG4gICAgICAgICAgICAgICAgLnNldExpbWl0cygzLCA2LCAxKVxuICAgICAgICAgICAgICAgIC5zZXREeW5hbWljVG9vbHRpcCgpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5yYW5kb21JRExlbmd0aCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnSW5pdGlhbCBzZXF1ZW50aWFsIElEIG51bWJlcicpXG4gICAgICAgICAgICAuc2V0RGVzYygnU3RhcnQgbnVtYmVyIGZvciBzZXF1ZW50aWFsIElEXFwncycpXG4gICAgICAgICAgICAuYWRkU2xpZGVyKHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5zZXF1ZW50aWFsU3RhcnROdW1iZXIpXG4gICAgICAgICAgICAgICAgLnNldExpbWl0cygwLCAxLCAxKVxuICAgICAgICAgICAgICAgIC5zZXREeW5hbWljVG9vbHRpcCgpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zZXF1ZW50aWFsU3RhcnROdW1iZXIgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ1JlbW92ZSB2b3dlbHMnKVxuICAgICAgICAgICAgLnNldERlc2MoJ1JlbW92ZSB2b3dlbHMgZnJvbSB0aGUgcHJlZml4IHdoZW4gZ2V0dGluZyBmcm9tIHRoZSBmaWxlbmFtZSBvciBibG9jayBuYW1lJylcbiAgICAgICAgICAgIC5hZGRUb2dnbGUodGV4dCA9PiB0ZXh0XG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnJlbW92ZVZvd2VscylcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnJlbW92ZVZvd2VscyA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnRmlyc3QgbGV0dGVyIG9mIHdvcmRzJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdPbmx5IHVzZSB0aGUgZmlyc3QgbGV0dGVyIG9mIHdvcmRzIHRvIGZvcm0gdGhlIHByZWZpeCcpXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5maXJzdExldHRlcnNPZldvcmRzKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmlyc3RMZXR0ZXJzT2ZXb3JkcyA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnQXV0b21hdGljYWxseSBhZGQgVGFnJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdBIHRhZyB0byBhZGQgdG8gZWFjaCB0YXNrIC0gZG8gbm90IGluY2x1ZGUgdGhlICMgc3ltYm9sJylcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5hdXRvbWF0aWNUYWdOYW1lKVxuICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihcIlRhZyBOYW1lXCIpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5hdXRvbWF0aWNUYWdOYW1lID0gdmFsdWUucmVwbGFjZUFsbCgnIycsICcnKTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ05lc3RlZCB0YWdzIGJlaGF2aW91cicpXG4gICAgICAgICAgICAuc2V0RGVzYygnRGV0ZXJtaW5lcyB3aGV0aGVyIG5lc3RlZCB0YWdzIHdpbGwgY3JlYXRlIHBhcmFsbGVsIGV4ZWN1dGlvbiB0YWdzIG9yIHNlcXVlbnRpYWwnKVxuICAgICAgICAgICAgLmFkZERyb3Bkb3duKGRyb3BEb3duID0+IHtcbiAgICAgICAgICAgICAgICBkcm9wRG93bi5hZGRPcHRpb24oJzEnLCAnUGFyYWxsZWwgRXhlY3V0aW9uJyk7XG4gICAgICAgICAgICAgICAgZHJvcERvd24uYWRkT3B0aW9uKCcyJywgJ1NlcXVlbnRpYWwgRXhlY3V0aW9uJylcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MubmVzdGVkVGFza0JlaGF2aW9yKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubmVzdGVkVGFza0JlaGF2aW9yID0gdmFsdWUgYXMgTmVzdGluZ0JlaGF2aW91cjtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSl9KTtcbiAgICB9XG59XG5cbiIsICJpbXBvcnQge0VkaXRvcn0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbi8vIFJlZ2V4IGZvciBibG9jayBib3VuZGFyeVxuY29uc3QgQkxPQ0tfQk9VTkRBUlkgPSAvXiMrXFxzLztcblxuaW50ZXJmYWNlIFNpbXBsZUN1cnNvciB7XG4gICAgbGluZTogbnVtYmVyXG59XG5cbmludGVyZmFjZSBTaW1wbGVFZGl0b3Ige1xuICAgIC8vIFRoaXMgaW50ZXJmYWNlIGlzIGNyZWF0ZWQgdG8gaGVscCB3aXRoIHRoZSBmdW5jdGlvbnMgaGVyZSB0aGF0IG5lZWQgdGhlIE9ic2lkaWFuIEVkaXRvclxuICAgIGdldEN1cnNvcigpOiBTaW1wbGVDdXJzb3I7XG4gICAgZ2V0TGluZShuOiBudW1iZXIpOiBzdHJpbmc7XG4gICAgbGluZUNvdW50KCk6IG51bWJlclxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBIZWxwZXIge1xuICAgIC8vIFNpbXBsZSBoZWxwZXIgY2xhc3MgdGhhdCBjb250YWlucyB0aGUgYnVzaW5lc3MgbG9naWNcbiAgICAvLyBvZiB0aGUgYXBwLiBUaGlzIGlzIGV4dHJhY3RlZCBoZXJlIHRvIGFsbG93IHVuaXQgdGVzdGluZ1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXROZXN0aW5nTGV2ZWwodGFza19tYXJrZXI6IHN0cmluZyk6IG51bWJlciB7XG4gICAgICAgIC8vIFRoZSBuZXN0aW5nIGxldmVsIGlzIHRoZSBudW1iZXIgb2Ygc3BhY2VzIGJlZm9yZSB0aGUgZmlyc3QgXCItXCIgY2hhcmFjdGVyXG4gICAgICAgIGxldCBwYXJ0cyA9IHRhc2tfbWFya2VyLnJlcGxhY2VBbGwoXCJcXG5cIiwgXCJcIikuc3BsaXQoXCItXCIpO1xuICAgICAgICByZXR1cm4gcGFydHNbMF0ubGVuZ3RoO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZW5lcmF0ZVJhbmRvbURpZ2l0cyhsZW5ndGg6IG51bWJlcik6IHN0cmluZyB7XG4gICAgICBjb25zdCBkaWdpdHMgPSAnMDEyMzQ1Njc4OSc7XG4gICAgICBsZXQgcmFuZG9tU3RyaW5nID0gJyc7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBkaWdpdHMubGVuZ3RoKTtcbiAgICAgICAgcmFuZG9tU3RyaW5nICs9IGRpZ2l0c1tyYW5kb21JbmRleF07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByYW5kb21TdHJpbmc7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldFByZWZpeEZyb21TdHJpbmcodGV4dDogc3RyaW5nLCBmaXJzdF9sZXR0ZXJzOiBib29sZWFuLCByZW1vdmVfdm93ZWxzOiBib29sZWFuKSB7XG4gICAgICAgIC8vIFJlbW92ZSBhbnkgc3BlY2lhbCBzaWduc1xuICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlQWxsKC9bI1xcW1xcXV0vZywgJycpO1xuICAgICAgICAvLyBCcmVhayBpbnRvIHdvcmRzXG4gICAgICAgIGxldCB3b3JkcyA9IHRleHQuc3BsaXQoL1xccysvKTtcbiAgICAgICAgdGV4dCA9IFwiXCI7XG4gICAgICAgIGZvciAobGV0IHdvcmQgb2Ygd29yZHMpIHtcbiAgICAgICAgICAgIGlmICh3b3JkKSB7XG4gICAgICAgICAgICAgICAgdGV4dCA9IGAke3RleHR9JHt3b3JkWzBdLnRvVXBwZXJDYXNlKCl9YDtcbiAgICAgICAgICAgICAgICBpZiAoIWZpcnN0X2xldHRlcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJlbWFpbmRlciA9IHdvcmQuc2xpY2UoMSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB2b3dlbHMgaWYgbmVlZGVkXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZW1vdmVfdm93ZWxzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZW1haW5kZXIgPSByZW1haW5kZXIucmVwbGFjZUFsbCgvW2FlaW91XS9nLCAnJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGAke3RleHR9JHtyZW1haW5kZXJ9YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gUmVtb3ZlIHNwYWNlc1xuICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlQWxsKCcgJywgJycpO1xuICAgICAgICByZXR1cm4gdGV4dDtcbiAgICB9XG5cbiAgICBzdGF0aWMgY2xlYXJCbG9ja0lEcyhzZWw6IHN0cmluZywgYXV0b21hdGljX3RhZzogc3RyaW5nKSB7XG4gICAgICAgIC8vIFJlbW92ZSBleGlzdGluZyBJRCdzXG4gICAgICAgIGxldCByZW1vdmVfaWQgPSAvWyBcXHRdP1x1RDgzQ1x1REQ5NFxcc1tcXHcsXStbIFxcdF0qL2c7XG4gICAgICAgIHNlbCA9IHNlbC5yZXBsYWNlQWxsKHJlbW92ZV9pZCwgJycpO1xuXG4gICAgICAgIC8vIFJlbW92ZSBleGlzdGluZyBCbG9ja3NcbiAgICAgICAgbGV0IHJlbW92ZV9ibG9jayA9IC9bIFxcdF0/XHUyNkQ0XFxzW1xcdyxdK1sgXFx0XSovZztcbiAgICAgICAgc2VsID0gc2VsLnJlcGxhY2VBbGwocmVtb3ZlX2Jsb2NrLCAnJyk7XG5cbiAgICAgICAgLy8gUmVtb3ZlIGV4aXN0aW5nIHRhZ3NcbiAgICAgICAgaWYgKGF1dG9tYXRpY190YWcpIHtcbiAgICAgICAgICAgIGxldCByZW1vdmVfdGFnID0gbmV3IFJlZ0V4cChcIl4oXFxcXHMqLVxcXFxzXFxcXFtbIHhcXFxcLVxcXFwvXVxcXVxcXFxzLiopKCNcIiArIGF1dG9tYXRpY190YWcgKyBcIikoLiopJFwiLCBcIm1nXCIpO1xuICAgICAgICAgICAgc2VsID0gc2VsLnJlcGxhY2VBbGwocmVtb3ZlX3RhZywgJyQxICQzJyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2VsO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRCbG9ja0VuZChlZGl0b3I6IFNpbXBsZUVkaXRvcikge1xuICAgICAgICAvLyBGaW5kIHRoZSBlbmQgb2YgdGhlIGJsb2NrXG4gICAgICAgIGxldCBibG9ja0VuZCA9IGVkaXRvci5nZXRDdXJzb3IoKS5saW5lO1xuICAgICAgICBpZiAoYmxvY2tFbmQgPj0gZWRpdG9yLmxpbmVDb3VudCgpIC0gMSkgcmV0dXJuIGJsb2NrRW5kICsgMTtcbiAgICAgICAgYmxvY2tFbmQgKz0gMTtcbiAgICAgICAgd2hpbGUgKCFCTE9DS19CT1VOREFSWS50ZXN0KGVkaXRvci5nZXRMaW5lKGJsb2NrRW5kKSkpIHtcbiAgICAgICAgICAgIGJsb2NrRW5kKys7XG4gICAgICAgICAgICBpZiAoYmxvY2tFbmQgPiBlZGl0b3IubGluZUNvdW50KCkgLSAxKSByZXR1cm4gYmxvY2tFbmQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJsb2NrRW5kO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRCbG9ja1N0YXJ0KGVkaXRvcjogU2ltcGxlRWRpdG9yKSB7XG4gICAgICAgIC8vIEZpbmQgdGhlIHN0YXJ0IG9mIHRoZSBibG9ja1xuICAgICAgICBsZXQgYmxvY2tTdGFydCA9IGVkaXRvci5nZXRDdXJzb3IoKS5saW5lO1xuICAgICAgICBpZiAoQkxPQ0tfQk9VTkRBUlkudGVzdChlZGl0b3IuZ2V0TGluZShibG9ja1N0YXJ0KSkpIHtcbiAgICAgICAgICAgIHJldHVybiBNYXRoLm1pbihlZGl0b3IubGluZUNvdW50KCkgLTEsIGJsb2NrU3RhcnQgKyAxKTtcbiAgICAgICAgfVxuICAgICAgICB3aGlsZSAoYmxvY2tTdGFydCA+IDAgJiYgIUJMT0NLX0JPVU5EQVJZLnRlc3QoZWRpdG9yLmdldExpbmUoYmxvY2tTdGFydCAtIDEpKSkge1xuICAgICAgICAgICAgYmxvY2tTdGFydC0tO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBibG9ja1N0YXJ0O1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRTZWN0aW9uTmFtZShlZGl0b3I6IFNpbXBsZUVkaXRvciwgZmlsZV9uYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgbGV0IHNlY3Rpb25fc3RhcnQgPSBIZWxwZXIuZ2V0QmxvY2tTdGFydChlZGl0b3IpO1xuICAgICAgICBsZXQgc2VjdGlvbl9saW5lO1xuICAgICAgICBpZiAoc2VjdGlvbl9zdGFydCA9PSAwKSB7XG4gICAgICAgICAgICBzZWN0aW9uX2xpbmUgPSBcIlwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2VjdGlvbl9saW5lID0gZWRpdG9yLmdldExpbmUoc2VjdGlvbl9zdGFydC0xKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElzIHRoZXJlIGEgYmxvY2sgYXQgYWxsIG9yIGFyZSB3ZSBqdXN0IGluIGEgZmlsZSB3aXRoIG5vIGJsb2Nrc1xuICAgICAgICBsZXQgcmF3X3ByZWZpeDtcbiAgICAgICAgaWYgKEJMT0NLX0JPVU5EQVJZLnRlc3Qoc2VjdGlvbl9saW5lKSkge1xuICAgICAgICAgICAgcmF3X3ByZWZpeCA9IHNlY3Rpb25fbGluZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFJldHVybiB0aGUgZmlsZW5hbWUgYW55d2F5XG4gICAgICAgICAgICByYXdfcHJlZml4ID0gZmlsZV9uYW1lO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByYXdfcHJlZml4O1xuICAgIH1cbn0iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsc0JBV087OztBQ1JQLElBQU0saUJBQWlCO0FBYXZCLElBQXFCLFNBQXJCLE1BQTRCO0FBQUE7QUFBQTtBQUFBLEVBR3hCLGNBQWM7QUFBQSxFQUNkO0FBQUEsRUFFQSxPQUFPLGdCQUFnQixhQUE2QjtBQUVoRCxRQUFJLFFBQVEsWUFBWSxXQUFXLE1BQU0sRUFBRSxFQUFFLE1BQU0sR0FBRztBQUN0RCxXQUFPLE1BQU0sQ0FBQyxFQUFFO0FBQUEsRUFDcEI7QUFBQSxFQUVBLE9BQU8scUJBQXFCLFFBQXdCO0FBQ2xELFVBQU0sU0FB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
