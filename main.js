/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => ProjectTasks
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");

// helpers.ts
var Helper = class {
  // Simple helper class that contains the business logic
  // of the app. This is extracted here to allow unit testing
  constructor() {
  }
  static getNestingLevel(task_marker) {
    let parts = task_marker.replaceAll("\n", "").split("-");
    return parts[0].length;
  }
  static generateRandomDigits(length) {
    const digits = "0123456789";
    let randomString = "";
    for (let i = 0; i < length; i++) {
      const randomIndex = Math.floor(Math.random() * digits.length);
      randomString += digits[randomIndex];
    }
    return randomString;
  }
  static getPrefixFromString(text, first_letters, remove_vowels) {
    text = text.replaceAll(/[#\[\]]/g, "");
    let words = text.split(/\s+/);
    text = "";
    for (let word of words) {
      if (word) {
        text = `${text}${word[0].toUpperCase()}`;
        if (!first_letters) {
          let remainder = word.slice(1);
          if (remove_vowels) {
            remainder = remainder.replaceAll(/[aeiou]/g, "");
          }
          text = `${text}${remainder}`;
        }
      }
    }
    text = text.replaceAll(" ", "");
    return text;
  }
};

// main.ts
var DEBUG = true;
var BLOCK_BOUNDARY = /^#+\s/;
var DEFAULT_SETTINGS = {
  idPrefixMethod: "1" /* UsePrefix */,
  projectPrefix: "prj",
  randomIDLength: 6,
  sequentialStartNumber: 1,
  removeVowels: false,
  firstLettersOfWords: false,
  automaticTagName: "Project",
  nestedTaskBehavior: "1" /* ParallelExecution */
};
var ProjectTasks = class extends import_obsidian.Plugin {
  async onload() {
    if (DEBUG)
      console.log("Project Tasks starting");
    await this.loadSettings();
    this.addCommand({
      id: "set-ids",
      name: "Set project ids on Selection",
      editorCallback: (editor, view) => {
        let sel = editor.getSelection();
        let lines = this.addTaskIDs(sel, this.getPrefix(editor, view));
        editor.replaceSelection(
          `${lines}`
        );
      }
    });
    this.addCommand({
      id: "clear-ids",
      name: "Clear project ids on Selection",
      editorCallback: (editor, view) => {
        let sel = editor.getSelection();
        let lines = this.clearBlockIDs(sel);
        editor.replaceSelection(
          `${lines}`
        );
      }
    });
    this.addCommand({
      id: "set-ids-block",
      name: "Set project ids on Block",
      editorCallback: (editor, view) => {
        this.blockUpdate(editor, this.getPrefix(editor, view), true);
      }
    });
    this.addCommand({
      id: "clear-ids-block",
      name: "Clear project ids on Block",
      editorCallback: (editor, view) => {
        this.blockUpdate(editor, this.getPrefix(editor, view), false);
      }
    });
    this.addCommand({
      id: "add-project-task-list",
      name: "Add active project task list",
      editorCallback: (editor, view) => {
        this.addActiveProjectList(editor);
      }
    });
    this.addSettingTab(new ProjectTasksSettingsTab(this.app, this));
  }
  addActiveProjectList(editor) {
    const active_tasks_view = `\`\`\`tasks
tags includes #${this.settings.automaticTagName}
not done
hide backlink
is not blocked
\`\`\``;
    editor.replaceSelection(active_tasks_view);
  }
  blockUpdate(editor, prefix, add_ids) {
    const cursor = editor.getCursor();
    const line = editor.getLine(cursor.line);
    let blockStart = this.getBlockStart(editor);
    let blockEnd = this.getBlockEnd(editor);
    let last_line_length = editor.getLine(blockEnd + 1).length;
    const blockContent = editor.getRange({ line: blockStart, ch: 0 }, { line: blockEnd, ch: last_line_length });
    if (DEBUG)
      console.log(`Start ${blockStart}, End ${blockEnd}, last length ${last_line_length}
Orig: ${blockContent}`);
    let lines;
    if (add_ids) {
      lines = this.addTaskIDs(blockContent, prefix);
    } else {
      lines = this.clearBlockIDs(blockContent);
    }
    if (DEBUG)
      console.log(`Start ${blockStart}, End ${blockEnd}, last length ${last_line_length}
Orig: ${blockContent}
New: ${lines}`);
    editor.replaceRange(lines, { line: blockStart, ch: 0 }, { line: blockEnd, ch: last_line_length });
  }
  getBlockEnd(editor) {
    let blockEnd = editor.getCursor().line;
    while (!BLOCK_BOUNDARY.test(editor.getLine(blockEnd))) {
      blockEnd++;
      if (blockEnd > editor.lineCount() - 1)
        return blockEnd;
    }
    return blockEnd;
  }
  getBlockStart(editor) {
    let blockStart = editor.getCursor().line;
    while (blockStart > 0 && !BLOCK_BOUNDARY.test(editor.getLine(blockStart - 1))) {
      blockStart--;
    }
    return blockStart;
  }
  clearBlockIDs(sel) {
    let remove_id = /\h?ðŸ†”\s[\w,]+\h*/g;
    sel = sel.replaceAll(remove_id, "");
    let remove_block = /\h?â›”\s[\w,]+\h*/g;
    sel = sel.replaceAll(remove_block, "");
    if (this.settings.automaticTagName) {
      let remove_tag = new RegExp("^(\\s*-\\s\\[[ x\\-\\/]]\\s.*)(#" + this.settings.automaticTagName + ")(.*)$", "mg");
      sel = sel.replaceAll(remove_tag, "$1 $3");
    }
    return sel;
  }
  getPrefix(editor, view) {
    let raw_prefix;
    switch (this.settings.idPrefixMethod) {
      case "1" /* UsePrefix */: {
        raw_prefix = this.settings.projectPrefix;
        break;
      }
      case "3" /* FileName */: {
        raw_prefix = this.getFilename(view);
        break;
      }
      case "2" /* SectionName */: {
        let section_start = this.getBlockStart(editor);
        let section_line;
        if (section_start == 0) {
          section_line = "";
        } else {
          section_line = editor.getLine(section_start - 1);
        }
        if (DEBUG)
          console.log("Prefix check .. Found section: ", section_start, section_line);
        if (BLOCK_BOUNDARY.test(section_line)) {
          raw_prefix = section_line;
        } else {
          raw_prefix = this.getFilename(view);
        }
        break;
      }
    }
    return Helper.getPrefixFromString(raw_prefix, this.settings.firstLettersOfWords, this.settings.removeVowels);
  }
  getFilename(view) {
    var _a;
    if (!((_a = view.file) == null ? void 0 : _a.name)) {
      return this.settings.projectPrefix;
    } else {
      return view.file.name.split(".")[0];
    }
  }
  addTaskIDs(sel, prefix) {
    const regex = /^(\s*-\s\[[ x\-\/]\]\s)?(.*)$/mg;
    sel = this.clearBlockIDs(sel);
    if (DEBUG)
      console.log(`Replaced ids and blocks to give: ${sel}`);
    const matches = sel.matchAll(regex);
    let lines = "";
    let first = true;
    let idx = 0;
    let nesting_ids = ["0:ERROR!"];
    let current_nesting = 0;
    let is_parallel = false;
    let this_id;
    for (const match of matches) {
      if (!first) {
        lines += "\n";
      }
      if (match[1]) {
        if (this.settings.nestedTaskBehavior == "1" /* ParallelExecution */) {
          let nesting_depth = Helper.getNestingLevel(match[1]);
          if (nesting_depth > current_nesting) {
            current_nesting += 1;
            is_parallel = true;
            nesting_ids.push(``);
          } else if (nesting_depth < current_nesting) {
            while (current_nesting > nesting_depth) {
              current_nesting -= 1;
              let nested = nesting_ids.pop();
              if (nested) {
                nesting_ids[nesting_ids.length - 1] += `,${nested}`;
              }
              is_parallel = current_nesting > 0;
            }
          }
        }
        let this_line;
        if (this.settings.idPrefixMethod == "1" /* UsePrefix */) {
          this_id = `${prefix}${Helper.generateRandomDigits(this.settings.randomIDLength)}`;
        } else {
          this_id = `${prefix}${idx + this.settings.sequentialStartNumber}`;
        }
        this_line = `${match[1]}${match[2].trim()} \u{1F194} ${this_id}`;
        if (idx > 0) {
          if (is_parallel) {
            this_line += ` \u26D4 ${nesting_ids[current_nesting - 1]}`;
          } else {
            this_line += ` \u26D4 ${nesting_ids.last()}`;
          }
        }
        if (this.settings.automaticTagName) {
          this_line += ` #${this.settings.automaticTagName}`;
        }
        lines += this_line;
        idx += 1;
        if (is_parallel) {
          if (nesting_ids.last())
            nesting_ids[nesting_ids.length - 1] += ",";
          nesting_ids[nesting_ids.length - 1] += `${this_id}`;
        } else {
          nesting_ids[nesting_ids.length - 1] = this_id;
        }
        if (DEBUG)
          console.log(`Nesting level ${current_nesting}, ids ${nesting_ids}`);
      } else {
        lines += `${match[2].trim()}`;
      }
      first = false;
    }
    return lines;
  }
  onunload() {
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
var ProjectTasksSettingsTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian.Setting(containerEl).setName("Project ID method").setDesc("Choose how the ID will be determined").addDropdown((dropDown) => {
      dropDown.addOption("1", "Use prefix");
      dropDown.addOption("2", "Use Section name");
      dropDown.addOption("3", "Use filename").setValue(this.plugin.settings.idPrefixMethod).onChange(async (value) => {
        this.plugin.settings.idPrefixMethod = value;
        await this.plugin.saveSettings();
      });
    });
    new import_obsidian.Setting(containerEl).setName("Project ID prefix").setDesc("Prefix to use when creating an ID for a task").addText((text) => text.setPlaceholder("ID prefix").setValue(this.plugin.settings.projectPrefix).onChange(async (value) => {
      this.plugin.settings.projectPrefix = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Length of random ID number").setDesc("How many digits to use for random ID when using a fixed prefix").addSlider((text) => text.setValue(this.plugin.settings.randomIDLength).setLimits(3, 6, 1).setDynamicTooltip().onChange(async (value) => {
      this.plugin.settings.randomIDLength = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Initial sequential ID number").setDesc("Start number for sequential ID's").addSlider((text) => text.setValue(this.plugin.settings.sequentialStartNumber).setLimits(0, 1, 1).setDynamicTooltip().onChange(async (value) => {
      this.plugin.settings.sequentialStartNumber = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Remove vowels").setDesc("Remove vowels from the prefix when getting from the filename or block name").addToggle((text) => text.setValue(this.plugin.settings.removeVowels).onChange(async (value) => {
      this.plugin.settings.removeVowels = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("First letter of words").setDesc("Only use the first letter of words to form the prefix").addToggle((text) => text.setValue(this.plugin.settings.firstLettersOfWords).onChange(async (value) => {
      this.plugin.settings.firstLettersOfWords = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Automatically add Tag").setDesc("A tag to add to each task - do not include the # symbol").addText((text) => text.setValue(this.plugin.settings.automaticTagName).setPlaceholder("Tag Name").onChange(async (value) => {
      this.plugin.settings.automaticTagName = value.replaceAll("#", "");
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Nested tags behaviour").setDesc("Determines whether nested tags will create parallel execution tags or sequential").addDropdown((dropDown) => {
      dropDown.addOption("1", "Parallel Execution");
      dropDown.addOption("2", "Sequential Execution").setValue(this.plugin.settings.nestedTaskBehavior).onChange(async (value) => {
        this.plugin.settings.nestedTaskBehavior = value;
        await this.plugin.saveSettings();
      });
    });
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJoZWxwZXJzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQge1xuICAgIEFwcCxcbiAgICBFZGl0b3IsXG4gICAgRWRpdG9yUG9zaXRpb24sIE1hcmtkb3duRmlsZUluZm8sXG4gICAgTWFya2Rvd25WaWV3LFxuICAgIE1vZGFsLFxuICAgIE5vdGljZSxcbiAgICBQbHVnaW4sXG4gICAgUGx1Z2luU2V0dGluZ1RhYixcbiAgICBTZXR0aW5nLFxuICAgIFZpZXdcbn0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0ICogYXMgbmV0IGZyb20gXCJuZXRcIjtcbmltcG9ydCBIZWxwZXIgZnJvbSBcIi4vaGVscGVyc1wiO1xuXG4vLyBUdXJuIG9uIHRvIGFsbG93IGRlYnVnZ2luZyBpbiB0aGUgY29uc29sZVxuY29uc3QgREVCVUcgPSB0cnVlO1xuLy8gUmVnZXggZm9yIGJsb2NrIGJvdW5kYXJ5XG5jb25zdCBCTE9DS19CT1VOREFSWSA9IC9eIytcXHMvO1xuXG5cblxuZW51bSBQcmVmaXhNZXRob2Qge1xuICAgIFVzZVByZWZpeD0gJzEnLFxuICAgIFNlY3Rpb25OYW1lID0gJzInLFxuICAgIEZpbGVOYW1lID0gJzMnXG59XG5cbmVudW0gTmVzdGluZ0JlaGF2aW91ciB7XG4gICAgUGFyYWxsZWxFeGVjdXRpb24gPSAnMScsXG4gICAgU2VxdWVudGlhbEV4ZWN1dGlvbiA9ICcyJyxcbn1cblxuaW50ZXJmYWNlIFByb2plY3RUYXNrc1NldHRpbmdzIHtcbiAgICBpZFByZWZpeE1ldGhvZDogUHJlZml4TWV0aG9kO1xuICAgIHByb2plY3RQcmVmaXg6IHN0cmluZztcbiAgICByYW5kb21JRExlbmd0aDogbnVtYmVyO1xuICAgIHNlcXVlbnRpYWxTdGFydE51bWJlcjogbnVtYmVyO1xuICAgIHJlbW92ZVZvd2VsczogYm9vbGVhbjtcbiAgICBmaXJzdExldHRlcnNPZldvcmRzOiBib29sZWFuO1xuICAgIGF1dG9tYXRpY1RhZ05hbWU6IHN0cmluZztcbiAgICBuZXN0ZWRUYXNrQmVoYXZpb3I6IE5lc3RpbmdCZWhhdmlvdXI7XG5cbn1cblxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogUHJvamVjdFRhc2tzU2V0dGluZ3MgPSB7XG4gICAgaWRQcmVmaXhNZXRob2Q6IFByZWZpeE1ldGhvZC5Vc2VQcmVmaXgsXG4gICAgcHJvamVjdFByZWZpeDogJ3ByaicsXG4gICAgcmFuZG9tSURMZW5ndGg6IDYsXG4gICAgc2VxdWVudGlhbFN0YXJ0TnVtYmVyOiAxLFxuICAgIHJlbW92ZVZvd2VsczogZmFsc2UsXG4gICAgZmlyc3RMZXR0ZXJzT2ZXb3JkczogZmFsc2UsXG4gICAgYXV0b21hdGljVGFnTmFtZTogXCJQcm9qZWN0XCIsXG4gICAgbmVzdGVkVGFza0JlaGF2aW9yOiBOZXN0aW5nQmVoYXZpb3VyLlBhcmFsbGVsRXhlY3V0aW9uLFxufVxuXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb2plY3RUYXNrcyBleHRlbmRzIFBsdWdpbiB7XG4gICAgc2V0dGluZ3M6IFByb2plY3RUYXNrc1NldHRpbmdzO1xuXG4gICAgYXN5bmMgb25sb2FkKCkge1xuICAgICAgICBpZiAoREVCVUcpIGNvbnNvbGUubG9nKCdQcm9qZWN0IFRhc2tzIHN0YXJ0aW5nJyk7XG5cbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcblxuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgaWQ6IFwic2V0LWlkc1wiLFxuICAgICAgICAgICAgbmFtZTogXCJTZXQgcHJvamVjdCBpZHMgb24gU2VsZWN0aW9uXCIsXG4gICAgICAgICAgICBlZGl0b3JDYWxsYmFjazogKGVkaXRvciwgdmlldykgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBzZWwgPSBlZGl0b3IuZ2V0U2VsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgbGV0IGxpbmVzID0gdGhpcy5hZGRUYXNrSURzKHNlbCwgdGhpcy5nZXRQcmVmaXgoZWRpdG9yLCB2aWV3KSk7XG4gICAgICAgICAgICAgICAgZWRpdG9yLnJlcGxhY2VTZWxlY3Rpb24oXG4gICAgICAgICAgICAgICAgICAgIGAke2xpbmVzfWBcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgaWQ6IFwiY2xlYXItaWRzXCIsXG4gICAgICAgICAgICBuYW1lOiBcIkNsZWFyIHByb2plY3QgaWRzIG9uIFNlbGVjdGlvblwiLFxuICAgICAgICAgICAgZWRpdG9yQ2FsbGJhY2s6IChlZGl0b3IsIHZpZXcpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgc2VsID0gZWRpdG9yLmdldFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgIGxldCBsaW5lcyA9IHRoaXMuY2xlYXJCbG9ja0lEcyhzZWwpO1xuICAgICAgICAgICAgICAgIGVkaXRvci5yZXBsYWNlU2VsZWN0aW9uKFxuICAgICAgICAgICAgICAgICAgICBgJHtsaW5lc31gXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiBcInNldC1pZHMtYmxvY2tcIixcbiAgICAgICAgICAgIG5hbWU6IFwiU2V0IHByb2plY3QgaWRzIG9uIEJsb2NrXCIsXG4gICAgICAgICAgICBlZGl0b3JDYWxsYmFjazogKGVkaXRvciwgdmlldykgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYmxvY2tVcGRhdGUoZWRpdG9yLCB0aGlzLmdldFByZWZpeChlZGl0b3IsIHZpZXcpLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcblxuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgaWQ6IFwiY2xlYXItaWRzLWJsb2NrXCIsXG4gICAgICAgICAgICBuYW1lOiBcIkNsZWFyIHByb2plY3QgaWRzIG9uIEJsb2NrXCIsXG4gICAgICAgICAgICBlZGl0b3JDYWxsYmFjazogKGVkaXRvciwgdmlldykgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYmxvY2tVcGRhdGUoZWRpdG9yLCB0aGlzLmdldFByZWZpeChlZGl0b3IsIHZpZXcpLCBmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG5cbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiBcImFkZC1wcm9qZWN0LXRhc2stbGlzdFwiLFxuICAgICAgICAgICAgbmFtZTogXCJBZGQgYWN0aXZlIHByb2plY3QgdGFzayBsaXN0XCIsXG4gICAgICAgICAgICBlZGl0b3JDYWxsYmFjazogKGVkaXRvciwgdmlldykgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkQWN0aXZlUHJvamVjdExpc3QoZWRpdG9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcblxuICAgICAgICAvLyBUaGlzIGFkZHMgYSBzZXR0aW5ncyB0YWIgc28gdGhlIHVzZXIgY2FuIGNvbmZpZ3VyZSB2YXJpb3VzIGFzcGVjdHMgb2YgdGhlIHBsdWdpblxuICAgICAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IFByb2plY3RUYXNrc1NldHRpbmdzVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG5cbiAgICB9XG5cbiAgICBhZGRBY3RpdmVQcm9qZWN0TGlzdChlZGl0b3I6IEVkaXRvcikge1xuICAgICAgICAvLyBBIHZpZXcgdG8gc2hvdyBhY3RpdmUgdGFza3NcbiAgICAgICAgY29uc3QgYWN0aXZlX3Rhc2tzX3ZpZXcgPSBgXFxgXFxgXFxgdGFza3NcbnRhZ3MgaW5jbHVkZXMgIyR7dGhpcy5zZXR0aW5ncy5hdXRvbWF0aWNUYWdOYW1lfVxubm90IGRvbmVcbmhpZGUgYmFja2xpbmtcbmlzIG5vdCBibG9ja2VkXG5cXGBcXGBcXGBgO1xuICAgICAgICBlZGl0b3IucmVwbGFjZVNlbGVjdGlvbihhY3RpdmVfdGFza3Nfdmlldyk7XG4gICAgfVxuXG4gICAgYmxvY2tVcGRhdGUoZWRpdG9yOiBFZGl0b3IsIHByZWZpeDogc3RyaW5nLCBhZGRfaWRzOiBib29sZWFuKSB7XG4gICAgICAgIGNvbnN0IGN1cnNvciA9IGVkaXRvci5nZXRDdXJzb3IoKTtcbiAgICAgICAgY29uc3QgbGluZSA9IGVkaXRvci5nZXRMaW5lKGN1cnNvci5saW5lKTtcblxuICAgICAgICAvLyBHZXQgdGhlIGJsb2NrIGJvdW5kYXJpZXNcbiAgICAgICAgbGV0IGJsb2NrU3RhcnQgPSB0aGlzLmdldEJsb2NrU3RhcnQoZWRpdG9yKTtcbiAgICAgICAgbGV0IGJsb2NrRW5kID0gdGhpcy5nZXRCbG9ja0VuZChlZGl0b3IpO1xuICAgICAgICBsZXQgbGFzdF9saW5lX2xlbmd0aCA9IGVkaXRvci5nZXRMaW5lKGJsb2NrRW5kICsgMSkubGVuZ3RoO1xuXG4gICAgICAgIGNvbnN0IGJsb2NrQ29udGVudCA9IGVkaXRvci5nZXRSYW5nZSh7IGxpbmU6IGJsb2NrU3RhcnQsIGNoOiAwIH0sIHsgbGluZTogYmxvY2tFbmQsIGNoOiBsYXN0X2xpbmVfbGVuZ3RoIH0pO1xuICAgICAgICBpZiAoREVCVUcpIGNvbnNvbGUubG9nKGBTdGFydCAke2Jsb2NrU3RhcnR9LCBFbmQgJHtibG9ja0VuZH0sIGxhc3QgbGVuZ3RoICR7bGFzdF9saW5lX2xlbmd0aH1cXG5PcmlnOiAke2Jsb2NrQ29udGVudH1gKTtcblxuICAgICAgICBsZXQgbGluZXM7XG4gICAgICAgIGlmIChhZGRfaWRzKSB7XG4gICAgICAgICAgICBsaW5lcyA9IHRoaXMuYWRkVGFza0lEcyhibG9ja0NvbnRlbnQsIHByZWZpeCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsaW5lcyA9IHRoaXMuY2xlYXJCbG9ja0lEcyhibG9ja0NvbnRlbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKERFQlVHKSBjb25zb2xlLmxvZyhgU3RhcnQgJHtibG9ja1N0YXJ0fSwgRW5kICR7YmxvY2tFbmR9LCBsYXN0IGxlbmd0aCAke2xhc3RfbGluZV9sZW5ndGh9XFxuT3JpZzogJHtibG9ja0NvbnRlbnR9XFxuTmV3OiAke2xpbmVzfWApO1xuICAgICAgICBlZGl0b3IucmVwbGFjZVJhbmdlKGxpbmVzLCB7IGxpbmU6IGJsb2NrU3RhcnQsIGNoOiAwIH0sIHsgbGluZTogYmxvY2tFbmQsIGNoOiBsYXN0X2xpbmVfbGVuZ3RoIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0QmxvY2tFbmQoZWRpdG9yOiBFZGl0b3IpIHtcbiAgICAgICAgLy8gRmluZCB0aGUgZW5kIG9mIHRoZSBibG9ja1xuICAgICAgICBsZXQgYmxvY2tFbmQgPSBlZGl0b3IuZ2V0Q3Vyc29yKCkubGluZTtcbiAgICAgICAgd2hpbGUgKCFCTE9DS19CT1VOREFSWS50ZXN0KGVkaXRvci5nZXRMaW5lKGJsb2NrRW5kKSkpIHtcbiAgICAgICAgICAgIGJsb2NrRW5kKys7XG4gICAgICAgICAgICBpZiAoYmxvY2tFbmQgPiBlZGl0b3IubGluZUNvdW50KCkgLSAxKSByZXR1cm4gYmxvY2tFbmQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJsb2NrRW5kO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0QmxvY2tTdGFydChlZGl0b3I6IEVkaXRvcikge1xuICAgICAgICAvLyBGaW5kIHRoZSBzdGFydCBvZiB0aGUgYmxvY2tcbiAgICAgICAgbGV0IGJsb2NrU3RhcnQgPSBlZGl0b3IuZ2V0Q3Vyc29yKCkubGluZTtcbiAgICAgICAgd2hpbGUgKGJsb2NrU3RhcnQgPiAwICYmICFCTE9DS19CT1VOREFSWS50ZXN0KGVkaXRvci5nZXRMaW5lKGJsb2NrU3RhcnQgLSAxKSkpIHtcbiAgICAgICAgICAgIGJsb2NrU3RhcnQtLTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYmxvY2tTdGFydDtcbiAgICB9XG5cblxuXG4gICAgY2xlYXJCbG9ja0lEcyhzZWw6IHN0cmluZykge1xuICAgICAgICAvLyBSZW1vdmUgZXhpc3RpbmcgSUQnc1xuICAgICAgICBsZXQgcmVtb3ZlX2lkID0gL1xcaD9cdUQ4M0NcdUREOTRcXHNbXFx3LF0rXFxoKi9nO1xuICAgICAgICBzZWwgPSBzZWwucmVwbGFjZUFsbChyZW1vdmVfaWQsICcnKTtcblxuICAgICAgICAvLyBSZW1vdmUgZXhpc3RpbmcgQmxvY2tzXG4gICAgICAgIGxldCByZW1vdmVfYmxvY2sgPSAvXFxoP1x1MjZENFxcc1tcXHcsXStcXGgqL2c7XG4gICAgICAgIHNlbCA9IHNlbC5yZXBsYWNlQWxsKHJlbW92ZV9ibG9jaywgJycpO1xuXG4gICAgICAgIC8vIFJlbW92ZSBleGlzdGluZyB0YWdzXG4gICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmF1dG9tYXRpY1RhZ05hbWUpIHtcbiAgICAgICAgICAgIGxldCByZW1vdmVfdGFnID0gbmV3IFJlZ0V4cChcIl4oXFxcXHMqLVxcXFxzXFxcXFtbIHhcXFxcLVxcXFwvXVxcXVxcXFxzLiopKCNcIiArIHRoaXMuc2V0dGluZ3MuYXV0b21hdGljVGFnTmFtZSArIFwiKSguKikkXCIsIFwibWdcIik7XG4gICAgICAgICAgICBzZWwgPSBzZWwucmVwbGFjZUFsbChyZW1vdmVfdGFnLCAnJDEgJDMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzZWw7XG4gICAgfVxuXG5cbiAgICBnZXRQcmVmaXgoZWRpdG9yOiBFZGl0b3IsIHZpZXc6IE1hcmtkb3duRmlsZUluZm8pIHtcbiAgICAgICAgbGV0IHJhd19wcmVmaXg7XG4gICAgICAgIHN3aXRjaCAodGhpcy5zZXR0aW5ncy5pZFByZWZpeE1ldGhvZCkge1xuICAgICAgICAgICAgY2FzZSBQcmVmaXhNZXRob2QuVXNlUHJlZml4OiB7XG4gICAgICAgICAgICAgICAgcmF3X3ByZWZpeCA9IHRoaXMuc2V0dGluZ3MucHJvamVjdFByZWZpeDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgUHJlZml4TWV0aG9kLkZpbGVOYW1lOiB7XG4gICAgICAgICAgICAgICAgcmF3X3ByZWZpeCA9IHRoaXMuZ2V0RmlsZW5hbWUodmlldyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFByZWZpeE1ldGhvZC5TZWN0aW9uTmFtZToge1xuICAgICAgICAgICAgICAgIC8vIFRyeSB0byBmaW5kIHRoZSBuYW1lIG9mIHRoZSBibG9jayB0aGF0IGNvbnRhaW5zIHRoZSBjdXJzb3Igb3IgdGhlIHNlbGVjdGlvblxuICAgICAgICAgICAgICAgIGxldCBzZWN0aW9uX3N0YXJ0ID0gdGhpcy5nZXRCbG9ja1N0YXJ0KGVkaXRvcik7XG4gICAgICAgICAgICAgICAgbGV0IHNlY3Rpb25fbGluZTtcbiAgICAgICAgICAgICAgICBpZiAoc2VjdGlvbl9zdGFydCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlY3Rpb25fbGluZSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2VjdGlvbl9saW5lID0gZWRpdG9yLmdldExpbmUoc2VjdGlvbl9zdGFydC0xKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKERFQlVHKSBjb25zb2xlLmxvZygnUHJlZml4IGNoZWNrIC4uIEZvdW5kIHNlY3Rpb246ICcsIHNlY3Rpb25fc3RhcnQsIHNlY3Rpb25fbGluZSk7XG5cbiAgICAgICAgICAgICAgICAvLyBJcyB0aGVyZSBhIGJsb2NrIGF0IGFsbCBvciBhcmUgd2UganVzdCBpbiBhIGZpbGUgd2l0aCBubyBibG9ja3NcbiAgICAgICAgICAgICAgICBpZiAoQkxPQ0tfQk9VTkRBUlkudGVzdChzZWN0aW9uX2xpbmUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJhd19wcmVmaXggPSBzZWN0aW9uX2xpbmU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSBmaWxlbmFtZSBhbnl3YXlcbiAgICAgICAgICAgICAgICAgICAgcmF3X3ByZWZpeCA9IHRoaXMuZ2V0RmlsZW5hbWUodmlldyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBIZWxwZXIuZ2V0UHJlZml4RnJvbVN0cmluZyhyYXdfcHJlZml4LCB0aGlzLnNldHRpbmdzLmZpcnN0TGV0dGVyc09mV29yZHMsIHRoaXMuc2V0dGluZ3MucmVtb3ZlVm93ZWxzKTtcbiAgICB9XG5cbiAgICBnZXRGaWxlbmFtZSh2aWV3OiBNYXJrZG93bkZpbGVJbmZvKSB7XG4gICAgICAgaWYgKCF2aWV3LmZpbGU/Lm5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNldHRpbmdzLnByb2plY3RQcmVmaXg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdmlldy5maWxlLm5hbWUuc3BsaXQoJy4nKVswXTtcbiAgICAgICAgfVxuICAgIH1cblxuXG5cblxuICAgIGFkZFRhc2tJRHMoc2VsOiBzdHJpbmcsIHByZWZpeDogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IHJlZ2V4ID0gL14oXFxzKi1cXHNcXFtbIHhcXC1cXC9dXFxdXFxzKT8oLiopJC9tZztcblxuICAgICAgICAvLyBDbGVhciBhbGwgdGhlIGV4aXN0aW5nIGJsb2NrIGFuZCBwcm9qZWN0IElEJ3NcbiAgICAgICAgc2VsID0gdGhpcy5jbGVhckJsb2NrSURzKHNlbCk7XG5cbiAgICAgICAgaWYgKERFQlVHKSBjb25zb2xlLmxvZyhgUmVwbGFjZWQgaWRzIGFuZCBibG9ja3MgdG8gZ2l2ZTogJHtzZWx9YCk7XG5cbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IHNlbC5tYXRjaEFsbChyZWdleCk7XG4gICAgICAgIGxldCBsaW5lcyA9IFwiXCI7XG4gICAgICAgIGxldCBmaXJzdCA9IHRydWU7XG4gICAgICAgIGxldCBpZHggPSAwO1xuICAgICAgICBsZXQgbmVzdGluZ19pZHMgPSBbXCIwOkVSUk9SIVwiXTtcbiAgICAgICAgbGV0IGN1cnJlbnRfbmVzdGluZyA9IDA7XG4gICAgICAgIGxldCBpc19wYXJhbGxlbCA9IGZhbHNlO1xuICAgICAgICBsZXQgdGhpc19pZDtcblxuICAgICAgICAvLyBHbyB0aHJvdWdoIGFsbCB0aGUgbGluZXMgYW5kIGFkZCBhcHByb3ByaWF0ZSBJRCBhbmQgYmxvY2sgdGFnc1xuICAgICAgICBmb3IgKGNvbnN0IG1hdGNoIG9mIG1hdGNoZXMpIHtcbiAgICAgICAgICAgIGlmICghZmlyc3QpIHtcbiAgICAgICAgICAgICAgICBsaW5lcyArPSBcIlxcblwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSXMgdGhpcyBhIHRhc2sgbGluZSBhdCBhbGw/XG4gICAgICAgICAgICBpZiAobWF0Y2hbMV0pIHtcbiAgICAgICAgICAgICAgICAvLyBXYXRjaCBvdXQgZm9yIGNoYW5nZXMgaW4gbmVzdGluZ1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLm5lc3RlZFRhc2tCZWhhdmlvciA9PSBOZXN0aW5nQmVoYXZpb3VyLlBhcmFsbGVsRXhlY3V0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBuZXN0aW5nX2RlcHRoID0gSGVscGVyLmdldE5lc3RpbmdMZXZlbChtYXRjaFsxXSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXN0aW5nX2RlcHRoID4gY3VycmVudF9uZXN0aW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgYSBuZXcgbGV2ZWwgb2YgbmVzdGluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF9uZXN0aW5nICs9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBpc19wYXJhbGxlbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXN0aW5nX2lkcy5wdXNoKGBgKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuZXN0aW5nX2RlcHRoIDwgY3VycmVudF9uZXN0aW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgbGV2ZWxzIG9mIG5lc3RpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChjdXJyZW50X25lc3RpbmcgPiBuZXN0aW5nX2RlcHRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF9uZXN0aW5nIC09IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5lc3RlZCA9IG5lc3RpbmdfaWRzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmVzdGluZ19pZHNbbmVzdGluZ19pZHMubGVuZ3RoIC0gMV0gKz0gYCwke25lc3RlZH1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc19wYXJhbGxlbCA9IGN1cnJlbnRfbmVzdGluZyA+IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGV0IHRoaXNfbGluZTtcbiAgICAgICAgICAgICAgICAvLyBHZXQgYW4gaWQgdG8gdXNlXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuaWRQcmVmaXhNZXRob2QgPT0gUHJlZml4TWV0aG9kLlVzZVByZWZpeCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzX2lkID0gYCR7cHJlZml4fSR7SGVscGVyLmdlbmVyYXRlUmFuZG9tRGlnaXRzKHRoaXMuc2V0dGluZ3MucmFuZG9tSURMZW5ndGgpfWA7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpc19pZCA9IGAke3ByZWZpeH0ke2lkeCArIHRoaXMuc2V0dGluZ3Muc2VxdWVudGlhbFN0YXJ0TnVtYmVyfWA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgaWQgaW50byB0aGVyZVxuICAgICAgICAgICAgICAgIHRoaXNfbGluZSA9IGAke21hdGNoWzFdfSR7bWF0Y2hbMl0udHJpbSgpfSBcdUQ4M0NcdUREOTQgJHt0aGlzX2lkfWA7XG4gICAgICAgICAgICAgICAgaWYgKGlkeCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHRoZSBibG9ja3MgYWZ0ZXIgdGhlIHZlcnkgZmlyc3QgdGFza1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNfcGFyYWxsZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNfbGluZSArPSBgIFx1MjZENCAke25lc3RpbmdfaWRzW2N1cnJlbnRfbmVzdGluZyAtIDFdfWA7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzX2xpbmUgKz0gYCBcdTI2RDQgJHtuZXN0aW5nX2lkcy5sYXN0KCl9YDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEFkZCBhbiBhdXRvbWF0aWMgdGFnIGlmIHdlIG5lZWQgaXRcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5hdXRvbWF0aWNUYWdOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXNfbGluZSArPSBgICMke3RoaXMuc2V0dGluZ3MuYXV0b21hdGljVGFnTmFtZX1gO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEFwcGVuZCB0aGlzIGxpbmVcbiAgICAgICAgICAgICAgICBsaW5lcyArPSB0aGlzX2xpbmU7XG4gICAgICAgICAgICAgICAgaWR4ICs9IDE7XG4gICAgICAgICAgICAgICAgaWYgKGlzX3BhcmFsbGVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXN0aW5nX2lkcy5sYXN0KCkpIG5lc3RpbmdfaWRzW25lc3RpbmdfaWRzLmxlbmd0aCAtIDFdICs9IFwiLFwiO1xuICAgICAgICAgICAgICAgICAgICBuZXN0aW5nX2lkc1tuZXN0aW5nX2lkcy5sZW5ndGggLSAxXSArPSBgJHt0aGlzX2lkfWA7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbmVzdGluZ19pZHNbbmVzdGluZ19pZHMubGVuZ3RoIC0gMV0gPSB0aGlzX2lkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoREVCVUcpIGNvbnNvbGUubG9nKGBOZXN0aW5nIGxldmVsICR7Y3VycmVudF9uZXN0aW5nfSwgaWRzICR7bmVzdGluZ19pZHN9YCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIE5vdCBhIHRhc2sgbGluZSBzbyBqdXN0IGtlZXAgaXQgYXMgaXNcbiAgICAgICAgICAgICAgICBsaW5lcyArPSBgJHttYXRjaFsyXS50cmltKCl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpcnN0ID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGxpbmVzO1xuICAgIH1cblxuICAgIG9udW5sb2FkKCkge1xuXG4gICAgfVxuXG4gICAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xuICAgICAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcbiAgICB9XG5cbiAgICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XG4gICAgfVxufVxuXG5cbmNsYXNzIFByb2plY3RUYXNrc1NldHRpbmdzVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG4gICAgcGx1Z2luOiBQcm9qZWN0VGFza3M7XG5cbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBQcm9qZWN0VGFza3MpIHtcbiAgICAgICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB9XG5cbiAgICBkaXNwbGF5KCk6IHZvaWQge1xuICAgICAgICBjb25zdCB7Y29udGFpbmVyRWx9ID0gdGhpcztcblxuICAgICAgICBjb250YWluZXJFbC5lbXB0eSgpO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ1Byb2plY3QgSUQgbWV0aG9kJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdDaG9vc2UgaG93IHRoZSBJRCB3aWxsIGJlIGRldGVybWluZWQnKVxuICAgICAgICAgICAgLmFkZERyb3Bkb3duKGRyb3BEb3duID0+IHtcbiAgICAgICAgICAgICAgICBkcm9wRG93bi5hZGRPcHRpb24oJzEnLCAnVXNlIHByZWZpeCcpO1xuICAgICAgICAgICAgICAgIGRyb3BEb3duLmFkZE9wdGlvbignMicsICdVc2UgU2VjdGlvbiBuYW1lJyk7XG4gICAgICAgICAgICAgICAgZHJvcERvd24uYWRkT3B0aW9uKCczJywgJ1VzZSBmaWxlbmFtZScpXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmlkUHJlZml4TWV0aG9kKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuaWRQcmVmaXhNZXRob2QgPSB2YWx1ZSBhcyBQcmVmaXhNZXRob2Q7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pfSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnUHJvamVjdCBJRCBwcmVmaXgnKVxuICAgICAgICAgICAgLnNldERlc2MoJ1ByZWZpeCB0byB1c2Ugd2hlbiBjcmVhdGluZyBhbiBJRCBmb3IgYSB0YXNrJylcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignSUQgcHJlZml4JylcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvamVjdFByZWZpeClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnByb2plY3RQcmVmaXggPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ0xlbmd0aCBvZiByYW5kb20gSUQgbnVtYmVyJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdIb3cgbWFueSBkaWdpdHMgdG8gdXNlIGZvciByYW5kb20gSUQgd2hlbiB1c2luZyBhIGZpeGVkIHByZWZpeCcpXG4gICAgICAgICAgICAuYWRkU2xpZGVyKHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5yYW5kb21JRExlbmd0aClcbiAgICAgICAgICAgICAgICAuc2V0TGltaXRzKDMsIDYsIDEpXG4gICAgICAgICAgICAgICAgLnNldER5bmFtaWNUb29sdGlwKClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnJhbmRvbUlETGVuZ3RoID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdJbml0aWFsIHNlcXVlbnRpYWwgSUQgbnVtYmVyJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdTdGFydCBudW1iZXIgZm9yIHNlcXVlbnRpYWwgSURcXCdzJylcbiAgICAgICAgICAgIC5hZGRTbGlkZXIodGV4dCA9PiB0ZXh0XG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnNlcXVlbnRpYWxTdGFydE51bWJlcilcbiAgICAgICAgICAgICAgICAuc2V0TGltaXRzKDAsIDEsIDEpXG4gICAgICAgICAgICAgICAgLnNldER5bmFtaWNUb29sdGlwKClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnNlcXVlbnRpYWxTdGFydE51bWJlciA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnUmVtb3ZlIHZvd2VscycpXG4gICAgICAgICAgICAuc2V0RGVzYygnUmVtb3ZlIHZvd2VscyBmcm9tIHRoZSBwcmVmaXggd2hlbiBnZXR0aW5nIGZyb20gdGhlIGZpbGVuYW1lIG9yIGJsb2NrIG5hbWUnKVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSh0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MucmVtb3ZlVm93ZWxzKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucmVtb3ZlVm93ZWxzID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdGaXJzdCBsZXR0ZXIgb2Ygd29yZHMnKVxuICAgICAgICAgICAgLnNldERlc2MoJ09ubHkgdXNlIHRoZSBmaXJzdCBsZXR0ZXIgb2Ygd29yZHMgdG8gZm9ybSB0aGUgcHJlZml4JylcbiAgICAgICAgICAgIC5hZGRUb2dnbGUodGV4dCA9PiB0ZXh0XG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmZpcnN0TGV0dGVyc09mV29yZHMpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5maXJzdExldHRlcnNPZldvcmRzID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdBdXRvbWF0aWNhbGx5IGFkZCBUYWcnKVxuICAgICAgICAgICAgLnNldERlc2MoJ0EgdGFnIHRvIGFkZCB0byBlYWNoIHRhc2sgLSBkbyBub3QgaW5jbHVkZSB0aGUgIyBzeW1ib2wnKVxuICAgICAgICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9tYXRpY1RhZ05hbWUpXG4gICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKFwiVGFnIE5hbWVcIilcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9tYXRpY1RhZ05hbWUgPSB2YWx1ZS5yZXBsYWNlQWxsKCcjJywgJycpO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnTmVzdGVkIHRhZ3MgYmVoYXZpb3VyJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdEZXRlcm1pbmVzIHdoZXRoZXIgbmVzdGVkIHRhZ3Mgd2lsbCBjcmVhdGUgcGFyYWxsZWwgZXhlY3V0aW9uIHRhZ3Mgb3Igc2VxdWVudGlhbCcpXG4gICAgICAgICAgICAuYWRkRHJvcGRvd24oZHJvcERvd24gPT4ge1xuICAgICAgICAgICAgICAgIGRyb3BEb3duLmFkZE9wdGlvbignMScsICdQYXJhbGxlbCBFeGVjdXRpb24nKTtcbiAgICAgICAgICAgICAgICBkcm9wRG93bi5hZGRPcHRpb24oJzInLCAnU2VxdWVudGlhbCBFeGVjdXRpb24nKVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5uZXN0ZWRUYXNrQmVoYXZpb3IpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5uZXN0ZWRUYXNrQmVoYXZpb3IgPSB2YWx1ZSBhcyBOZXN0aW5nQmVoYXZpb3VyO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KX0pO1xuICAgIH1cbn1cblxuIiwgIlxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSGVscGVyIHtcbiAgICAvLyBTaW1wbGUgaGVscGVyIGNsYXNzIHRoYXQgY29udGFpbnMgdGhlIGJ1c2luZXNzIGxvZ2ljXG4gICAgLy8gb2YgdGhlIGFwcC4gVGhpcyBpcyBleHRyYWN0ZWQgaGVyZSB0byBhbGxvdyB1bml0IHRlc3RpbmdcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0TmVzdGluZ0xldmVsKHRhc2tfbWFya2VyOiBzdHJpbmcpOiBudW1iZXIge1xuICAgICAgICAvLyBUaGUgbmVzdGluZyBsZXZlbCBpcyB0aGUgbnVtYmVyIG9mIHNwYWNlcyBiZWZvcmUgdGhlIGZpcnN0IFwiLVwiIGNoYXJhY3RlclxuICAgICAgICBsZXQgcGFydHMgPSB0YXNrX21hcmtlci5yZXBsYWNlQWxsKFwiXFxuXCIsIFwiXCIpLnNwbGl0KFwiLVwiKTtcbiAgICAgICAgcmV0dXJuIHBhcnRzWzBdLmxlbmd0aDtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2VuZXJhdGVSYW5kb21EaWdpdHMobGVuZ3RoOiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgY29uc3QgZGlnaXRzID0gJzAxMjM0NTY3ODknO1xuICAgICAgbGV0IHJhbmRvbVN0cmluZyA9ICcnO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHJhbmRvbUluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogZGlnaXRzLmxlbmd0aCk7XG4gICAgICAgIHJhbmRvbVN0cmluZyArPSBkaWdpdHNbcmFuZG9tSW5kZXhdO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmFuZG9tU3RyaW5nO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRQcmVmaXhGcm9tU3RyaW5nKHRleHQ6IHN0cmluZywgZmlyc3RfbGV0dGVyczogYm9vbGVhbiwgcmVtb3ZlX3Zvd2VsczogYm9vbGVhbikge1xuICAgICAgICAvLyBSZW1vdmUgYW55IHNwZWNpYWwgc2lnbnNcbiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZUFsbCgvWyNcXFtcXF1dL2csICcnKTtcbiAgICAgICAgLy8gQnJlYWsgaW50byB3b3Jkc1xuICAgICAgICBsZXQgd29yZHMgPSB0ZXh0LnNwbGl0KC9cXHMrLyk7XG4gICAgICAgIHRleHQgPSBcIlwiO1xuICAgICAgICBmb3IgKGxldCB3b3JkIG9mIHdvcmRzKSB7XG4gICAgICAgICAgICBpZiAod29yZCkge1xuICAgICAgICAgICAgICAgIHRleHQgPSBgJHt0ZXh0fSR7d29yZFswXS50b1VwcGVyQ2FzZSgpfWA7XG4gICAgICAgICAgICAgICAgaWYgKCFmaXJzdF9sZXR0ZXJzKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCByZW1haW5kZXIgPSB3b3JkLnNsaWNlKDEpO1xuICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdm93ZWxzIGlmIG5lZWRlZFxuICAgICAgICAgICAgICAgICAgICBpZiAocmVtb3ZlX3Zvd2Vscykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVtYWluZGVyID0gcmVtYWluZGVyLnJlcGxhY2VBbGwoL1thZWlvdV0vZywgJycpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRleHQgPSBgJHt0ZXh0fSR7cmVtYWluZGVyfWA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIFJlbW92ZSBzcGFjZXNcbiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZUFsbCgnICcsICcnKTtcbiAgICAgICAgcmV0dXJuIHRleHQ7XG4gICAgfVxufSJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxzQkFXTzs7O0FDVlAsSUFBcUIsU0FBckIsTUFBNEI7QUFBQTtBQUFBO0FBQUEsRUFHeEIsY0FBYztBQUFBLEVBQ2Q7QUFBQSxFQUVBLE9BQU8sZ0JBQWdCLGFBQTZCO0FB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
